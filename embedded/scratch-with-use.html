<html>
<head>
  <meta charset="utf-8">
  <title>R&D page for Embedded Economy SVG</title>
  <style>
  </style>
</head>
<body>
  <div style="width: 100%">
    <svg viewBox="0 0 3088 2237" style="border: solid black">
      <style>
        @import url("https://fonts.googleapis.com/css?family=Poppins");
        @import url("./embedded-economy.css");
      </style>

      <!-- <image href="./English Embedded Economy.jpg" /> -->

      <defs>
        <!-- Arrowhead def -->
        <g id="dnjs-arrowhead"><path class="dnjs-arrowhead" d="M 0 0 L 30 0 M 0 0 L 0 30" /></g>
        <!-- Matter flow def -->
        <g id="dnjs-matter-flow">
          <path class="dnjs-matter-flow-background" transform-origin="0 0" transform="rotate(257) scale(0.1 0.1) translate(-2840 -96)"
          d="M1014,5038C1002,5025,951,4955,900,4881C587,4434,422,4030,354,3545C332,3395,329,2972,348,2830C421,2283,592,1874,921,1458C1089,1246,1391,961,1658,762C2053,467,2709,98,2833,100C2851,101,2845,110,2795,156C2762,186,2683,254,2620,307C1977,846,1604,1273,1370,1739C1250,1978,1188,2167,1138,2444C1110,2598,1108,2915,1134,3110C1182,3468,1290,3848,1410,4085C1470,4204,1578,4378,1619,4423z"/>
          <path class="dnjs-matter-flow-line" transform-origin="0 0" transform="rotate(257) scale(0.1 0.1) translate(-2840 -96)"
          d="M1014,5038C1002,5025,951,4955,900,4881C587,4434,422,4030,354,3545C332,3395,329,2972,348,2830C421,2283,592,1874,921,1458C1089,1246,1391,961,1658,762C2053,467,2709,98,2833,100C2851,101,2845,110,2795,156C2762,186,2683,254,2620,307C1977,846,1604,1273,1370,1739C1250,1978,1188,2167,1138,2444C1110,2598,1108,2915,1134,3110C1182,3468,1290,3848,1410,4085C1470,4204,1578,4378,1619,4423"/>
          <use href="#dnjs-arrowhead" class="dnjs-matter-flow-ahead" />
        </g>
        <!-- Energy flow defs -->
        <g id="dnjs-energy-flow-large">
          <path class="dnjs-energy-flow-large-background" d="M 70 947 L 347 947 L 495 1117 L 347 1318 L 72 1318z" />
          <path class="dnjs-energy-flow-large-foreground" d="M 70 947 L 347 947 L 495 1117 L 347 1318 L 70 1318  
          M 70 977 L 140 977 M 70 1009 L 140 1009 M 70 1039 L 140 1039 M 70 1071 140 1071 M 70 1101 L 140 1101 M 70 1132 L 140 1132
          M 70 1163 L 140 1163 M 70 1194 L 140 1194 M 70 1225 L 140 1225 M 70 1256 L 140 1256 M 70 1287 L 140 1287" />
        </g>
        <g id="dnjs-energy-flow-small">
          <path class="dnjs-energy-flow-small-background" d="M 570 1032 L 885 1032 L 958 1115 L 885 1217 L 570 1217" />
          <path class="dnjs-energy-flow-small-foreground" d="M 570 1032 L 885 1032 L 958 1115 L 885 1217 L 570 1217
          M 570 1063 L 640 1063 M 570 1094 L 640 1094 M 570 1124 L 640 1124 M 570 1156 L 640 1156  M 570 1186 L 640 1186" />
        </g>
        <!-- Financial flow arrow defs -->
        <g id="dnjs-financial-flow-arrow">
          <path class="dnjs-financial-flow-line" d="M 1402 986 A 197 197 0 0 1 1507 931"/>
          <use href="#dnjs-arrowhead" class="dnjs-financial-flow-ahead" transform="rotate(124 1508 930) translate(1508 930)"/>
        </g>
        <g id="dnjs-financial-flow-dbl-arrow">
          <use href="#dnjs-financial-flow-arrow" class="dnjs-financial-flow-dbl-arrow-clockwise" />
          <use href="#dnjs-financial-flow-arrow" class="dnjs-financial-flow-dbl-arrow-anticlockwise" transform-origin="1541 1125" transform="rotate(90) scale(1 -1)"/>
        </g>
        <!-- Economy quarters and spokes -->
        <g id="dnjs-economy-spoke"><line class="dnjs-economy-spoke" x1="1156" y1="740" x2="1402" y2="986" /></g>
        <g id="dnjs-economy-quarter-background">
          <path class="dnjs-economy-quarter-background" d="M 1156 740 A 545 545 0 0 1 1926 740 L 1680 986 A 197 197 0 0 0 1402 986z" />
        </g>
        <!-- Text paths -->
        <path id="dnjs-lmm-living-matter-path" d="M 849 457 A 1081 892 0 0 1 1206 280" />
        <path id="dnjs-lmm-and-materials-path" d="M 913 505 A 981 801 0 0 1 1252 353" />
        <path id="dnjs-wm-waste-path" d="M 1944 1895 A 1109 833 0 0 0 2121 1805" />
        <path id="dnjs-wm-matter-path" d="M 1971 1969 A 1109 833 0 0 0 2165 1876" />
        <path id="dnjs-ff-financial-path" d="M 1446 1045 A 118 105 0 0 1 1639 1046" />
        <path id="dnjs-ff-flows-path" d="M 1468 1262 A 156 156 0 0 0 1623 1255" />
      </defs>

      <!-- Ellipse backgrounds -->
      <path id="dnjs-earth2society-background" d="M 1541 136 A 1198 988 0 1 1 1540 136z M 1540 382 A 884 744 0 1 0 1541 382z" />
      <path id="dnjs-society2economy-background" d="M 1541 382 A 884 744 0 1 1 1540 382z M 1540 579 A 545 545 0 1 0 1541 579z" />
      <path id="dnjs-economy-outer-background" d="M 1541 579 A 545 545 0 1 1 1540 579z M 1540 928 A 197 197 0 1 0 1541 928z"/>
        
      <!-- Ellipse lines -->
      <ellipse id="dnjs-earth" cx="1541" cy="1125" rx="1198" ry="988"></ellipse>
      <ellipse id="dnjs-society" cx="1541" cy="1125" rx="884" ry="744"></ellipse>
      <circle id="dnjs-economy" cx="1541" cy="1125" r="545"/>
      
      <!-- Economy quater backgrounds -->
      <use id="dnjs-household-quarter-background" href="#dnjs-economy-quarter-background" />
      <use id="dnjs-state-quarter-background" href="#dnjs-economy-quarter-background" transform="rotate(90 1541 1125)" />
      <use id="dnjs-household-quarter-background" href="#dnjs-economy-quarter-background" transform="rotate(180 1541 1125)" />
      <use class="dnjs-state-quarter-background" href="#dnjs-economy-quarter-background" transform="rotate(270 1541 1125)" />

      <!-- Financial flows backgrounds-->
      <!-- <circle id="dnjs-financial-flows-background" cx="1541" cy="1125" r="197"/> -->

      <!-- Economy spokes -->
      <use id="dnjs-econ-spoke1" href="#dnjs-economy-spoke" transform="rotate(0)" />
      <use id="dnjs-econ-spoke2" href="#dnjs-economy-spoke" transform="rotate(90 1541 1125)" />
      <use id="dnjs-econ-spoke3" href="#dnjs-economy-spoke" transform="rotate(180 1541 1125)" />
      <use id="dnjs-econ-spoke4" href="#dnjs-economy-spoke" transform="rotate(270 1541 1125)" />

      <!-- Ellipse label backgrounds -->
      <rect id="dnjs-earth-text-background" x="1414" y="89" width="248" height="95" rx="15" />
      <rect id="dnjs-society-text-background" x="1376" y="342" width="336" height="95" rx="15" />
      <rect id="dnjs-economy-text-background" x="1347" y="557" width="380" height="95" rx="15" />

      <!-- Matter and waste flows-->
      <use id="dnjs-living-matter-flow" href="#dnjs-matter-flow" transform="translate(950 993) scale(1 -1) rotate(103)"/>
      <use id="dnjs-waste-matter-flow" href="#dnjs-matter-flow" transform="translate(2209 1780) rotate(253)"/>

      <!-- Energy and heat flows -->
      <use id="dnjs-solar-energy-flow" href="#dnjs-energy-flow-large" />
      <use id="dnjs-energy-flow" href="#dnjs-energy-flow-large" transform="translate(2522 0)" />
      <use id="dnjs-waste-heat-flow" href="#dnjs-energy-flow-small" />
      <use id="dnjs-heat-flow" href="#dnjs-energy-flow-small" transform="translate(1559 0)" />

      <!-- flow arcs and arrowheads -->
      <use id="dnjs-market-household-flow-arrow" href="#dnjs-financial-flow-dbl-arrow" />
      <use id="dnjs-household-state-flow-arrow" href="#dnjs-financial-flow-dbl-arrow" transform="rotate(90 1541 1125)"/>
      <use id="dnjs-state-commons-flow-arrow" href="#dnjs-financial-flow-dbl-arrow" transform="rotate(180 1541 1125)"/>
      <use id="dnjs-commons-market-flow-arrow" href="#dnjs-financial-flow-dbl-arrow" transform="rotate(270 1541 1125)"/>

      <!-- Text -->
      <text id="dnjs-economy-text" x="1366" y="626">ECONOMY</text>
      <text id="dnjs-society-text" x="1395" y="415">SOCIETY</text>
      <text id="dnjs-earth-text" x="1434" y="157">EARTH</text>

      <text id="dnjs-commons-text" x="1374" y="1511">commons</text>
      <text id="dnjs-household-text" x="1369" y="815">household</text>
      <text id="dnjs-market-text" x="1045" y="1144">market</text>
      <text id="dnjs-state-text" x="1821" y="1145">state</text>

      <text id="dnjs-se-solar-text" x="165" y="1107">solar</text>
      <text id="dnjs-se-energy-text" x="165" y="1188">energy</text>
      <text id="dnjs-energy-text" x="672" y="1145">energy</text>
      <text id="dnjs-wh-waste-text" x="2228" y="1105">waste</text>
      <text id="dnjs-wh-heat-text" x="2228" y="1190">heat</text>  
      <text id="dnjs-heat-text" x="2729" y="1146">heat</text>  
      
      <!-- Text on curved paths-->
      <text id="dnjs-lmm-living-matter-text">
        <textPath href="#dnjs-lmm-living-matter-path">living matter</textPath>  
      </text>
      <text id="dnjs-lmm-and-materials-text">
        <textPath class="dnjs-text-path" href="#dnjs-lmm-and-materials-path">&amp; materials</textPath>  
      </text>
      <text id="dnjs-wm-waste-text">
        <textPath href="#dnjs-wm-waste-path">waste</textPath>  
      </text>
      <text id="dnjs-wm-matter-text">
        <textPath href="#dnjs-wm-matter-path">matter</textPath>  
      </text>
      <text id="dnjs-ff-financial-text">
        <textPath href="#dnjs-ff-financial-path">financial</textPath>  
      </text>
      <text id="dnjs-ff-flows-text">
        <textPath href="#dnjs-ff-flows-path">flows</textPath>  
      </text>

      <!-- Attribution etc -->
      <g id="dnjs-attribution-text" >
        <text x="2570" y="2120"  id="dnjs-attribution-title-text" style="font-weight: bold">The Embedded Economy</text>
        <text  x="2020" y="2170" id="dnjs-attribution-after-text">After: Kate Raworth and Marcia Mihotich. CC-BY-SA 4.0</text>
      </g>
    </svg>
  </div>
</body>
<script src="../../work/d3.v7.js"></script>

<script>
  const w = 3088 
  const h = 2237

  const cx=1541
  const cy=1125

  const svg = document.querySelector('svg')
  const pt = svg.createSVGPoint()
  function cursorPoint(evt){
    pt.x = evt.clientX; pt.y = evt.clientY
    return pt.matrixTransform(svg.getScreenCTM().inverse())
  }
  svg.addEventListener('click',function(evt){
    const pt = cursorPoint(evt)
    console.log('svg', Math.round(pt.x), Math.round(pt.y))
    console.log('radius', Math.round(Math.sqrt((pt.x-cx)*(pt.x-cx)+(pt.y-cy)*(pt.y-cy))))
    //console.log('centre', Math.round(pt.x-w/2), Math.round(pt.y-h/2))
    console.log('centre', Math.round(pt.x-cx), Math.round(pt.y-cy))
  },false)

  //xyFromAngleAndRad(197, 190)
  xyFromAngleAndRad(197, 190)

 // xyFromAngleAndRad(100, 0)

  function xyFromAngleAndRad(rad, ang) {
    const x = rad * Math.sin(Math.PI*(ang)/180) 
    const y = rad * Math.cos(Math.PI*(ang)/180)
    console.log(x, y)
    console.log('x,y:', Math.round(cx+x), Math.round(cy-y))
  }
</script>
</html>